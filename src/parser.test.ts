import {parseFolder, unchunkLink} from "./parser";

describe('parseFolder', () => {
  it('should parse html1', () => {
    //const html = `<html><head><script language=Javascript><!--if (parent.frames.length == 0) location.href="game.php";top.charpane.location.href="charpane.php";var actions = {  }var notchat = true;//--></script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/keybinds.min.2.js"></script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/window.20111231.js"></script><script language="javascript">function chatFocus(){if(top.chatpane.document.chatform.graf) top.chatpane.document.chatform.graf.focus();}if (typeof defaultBind != 'undefined') { defaultBind(47, 2, chatFocus); defaultBind(190, 2, chatFocus);defaultBind(191, 2, chatFocus); defaultBind(47, 8, chatFocus);defaultBind(190, 8, chatFocus); defaultBind(191, 8, chatFocus); }</script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/jquery-1.3.1.min.js"></script><script>jQuery(function ($) {$('.grower').each(function () {var t = $(this);var sz = t.attr('data-size');var hgt = t.height();t.css('height', (Math.ceil(hgt / sz) * sz) + 'px');});});</script><script language=Javascript>jQuery(function($) {$('#export').click(function () {$(this).parent().remove();return true;});$('.procbot input').click(function (e) {var pb = $(this).parent();var hid = pb.find('div:hidden');hid.eq(0).show();if (hid.length == 1) $(this).hide();});});<!--function toggleall() {var newval;if (document.messageform[3].checked==true) newval=false; else newval=true;for(var i=0;i<document.messageform.length;i++) {if (document.messageform[i].type=='checkbox') document.messageform[i].checked=newval;}}//--></script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/window.js"></script><script language=Javascript src='https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/rcm.20160406.js'></script>\t<link rel="stylesheet" type="text/css" href="https://s3.amazonaws.com/images.kingdomofloathing.com/styles.20151006.css"><style type='text/css'>.faded {zoom: 1;filter: alpha(opacity=35);opacity: 0.35;-khtml-opacity: 0.35;-moz-opacity: 0.35;}</style></head><body><div id='menu' class=rcm></div><centeR><table  width=95%  cellspacing=0 cellpadding=0><tr><td style="color: white;" align=center bgcolor=blue><b>Messages: Inbox, page 1 (3 messages)</b></td></tr><tr><td style="padding: 5px; border: 1px solid blue;"><center><table><tr><td><center class=small><a href='sendmessage.php'>[write a message]</a><br><a href='makeoffer.php'>[propose or accept a trade]</a>&nbsp;&nbsp;<a href='messages.php?events=1'>[review recent events]</a></center><table width=100%><form name=messageform method=post action=messages.php><input type=hidden name=the_action value=""><input type=hidden name=pwd value="6e1db391f3ca9b4470eb0679488e9c73"><input type=hidden name=box value="Inbox"><tr><td colspan=2><table width=100%><tr><td class=small valign=bottom>Mailbox: <b>[Inbox]</b> &nbsp;<a href='messages.php?box=Outbox'>[Outbox]</a> &nbsp;<a href='messages.php?box=Saved'>[Saved]</a> &nbsp; &nbsp;</td><td class=small align=right>Show <select onchange='location.href = "messages.php?box=Inbox&begin=1&per_page=" + this.options[this.selectedIndex].value'><option value=1>10</option><option value=2 selected>20</option><option value=5>50</option><option value=10>100</option></select> per page</td></tr></table></td></tr><tr><td align="center" colspan="2" style="font-size: 0.8em; padding-bottom: 0.5em; font-weight: bold;">Note:  Messages in this mailbox will be deleted after two weeks.</td></tr><tr><td align=center valign=bottom><a href="javascript:toggleall();"><b>X</b></a></td><td><table width=100%><tr><td class=small>&nbsp;</td><td align=right class=small>With checked: <a href='javascript:with(document.messageform) { the_action.value="save"; submit(); }'>[save]</a> <a href='javascript:with(document.messageform) { the_action.value="delete"; submit(); }'>[delete]</a></td></tr></table></td></tr><tr><td valign=top><input type=checkbox name="sel143138286"></td><td class=small><b>From</b> <a href="showplayer.php?who=1889009">Buffy</a> (#1889009)&nbsp;[<a href="sendmessage.php?toid=1889009&replyid=143138286">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1889009&quoteid=143138286&box=Inbox">quoted</a>]<br><b>Date:</b> Monday, May 31, 2021, 11:18PM</b><!--05/31/21 23:18:26--><br><blockquote><center><table><tr><td><img src="https://s3.amazonaws.com/images.kingdomofloathing.com/itemimages/meat.gif" height=30 width=30 alt="Meat"></td><td valign=center>You gain 180,000,000 Meat.</td></tr></table></center></blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143101095"></td><td class=small><b>From</b> <a href="showplayer.php?who=1852283">StuBorn</a> (#1852283)&nbsp;[<a href="sendmessage.php?toid=1852283&replyid=143101095">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1852283&quoteid=143101095&box=Inbox">quoted</a>]<br><b>Date:</b> Tuesday, May 25, 2021, 12:43AM</b><!--05/25/21 00:43:51--><br><blockquote>oi2</blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143101089"></td><td class=small><b>From</b> <a href="showplayer.php?who=1852283">StuBorn</a> (#1852283)&nbsp;[<a href="sendmessage.php?toid=1852283&replyid=143101089">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1852283&quoteid=143101089&box=Inbox">quoted</a>]<br><b>Date:</b> Tuesday, May 25, 2021, 12:41AM</b><!--05/25/21 00:41:55--><br><blockquote>oi</blockquote></td></tr><tr><td align=center valign=bottom><a href="javascript:toggleall();"><b>X</b></a></td><td><table width=100%><tr><td class=small>&nbsp;</td><td align=right class=small>With checked: <a href='javascript:with(document.messageform) { the_action.value="save"; submit(); }'>[save]</a> <a href='javascript:with(document.messageform) { the_action.value="delete"; submit(); }'>[delete]</a></td></tr></table></td></tr></form></table></td></tr></table></center></td></tr><tr><td height=4></td></tr></table></center></body></html>`;
    //const html = `<html><head><script language=Javascript><!--if (parent.frames.length == 0) location.href="game.php";var actions = {  }var notchat = true;//--></script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/keybinds.min.2.js"></script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/window.20111231.js"></script><script language="javascript">function chatFocus(){if(top.chatpane.document.chatform.graf) top.chatpane.document.chatform.graf.focus();}if (typeof defaultBind != 'undefined') { defaultBind(47, 2, chatFocus); defaultBind(190, 2, chatFocus);defaultBind(191, 2, chatFocus); defaultBind(47, 8, chatFocus);defaultBind(190, 8, chatFocus); defaultBind(191, 8, chatFocus); }</script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/jquery-1.3.1.min.js"></script><script>jQuery(function ($) {$('.grower').each(function () {var t = $(this);var sz = t.attr('data-size');var hgt = t.height();t.css('height', (Math.ceil(hgt / sz) * sz) + 'px');});});</script><script language=Javascript>jQuery(function($) {$('#export').click(function () {$(this).parent().remove();return true;});$('.procbot input').click(function (e) {var pb = $(this).parent();var hid = pb.find('div:hidden');hid.eq(0).show();if (hid.length == 1) $(this).hide();});});<!--function toggleall() {var newval;if (document.messageform[3].checked==true) newval=false; else newval=true;for(var i=0;i<document.messageform.length;i++) {if (document.messageform[i].type=='checkbox') document.messageform[i].checked=newval;}}//--></script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/window.js"></script><script language=Javascript src='https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/rcm.20160406.js'></script>\t<link rel="stylesheet" type="text/css" href="https://s3.amazonaws.com/images.kingdomofloathing.com/styles.20151006.css"><style type='text/css'>.faded {zoom: 1;filter: alpha(opacity=35);opacity: 0.35;-khtml-opacity: 0.35;-moz-opacity: 0.35;}</style></head><body><div id='menu' class=rcm></div><centeR><table  width=95%  cellspacing=0 cellpadding=0><tr><td style="color: white;" align=center bgcolor=blue><b>Messages: Inbox, page 1 (5 messages)</b></td></tr><tr><td style="padding: 5px; border: 1px solid blue;"><center><table><tr><td><center class=small><a href='sendmessage.php'>[write a message]</a><br><a href='makeoffer.php'>[propose or accept a trade]</a>&nbsp;&nbsp;<a href='messages.php?events=1'>[review recent events]</a></center><table width=100%><form name=messageform method=post action=messages.php><input type=hidden name=the_action value=""><input type=hidden name=pwd value="a020091fb5586ba314a7c993fd0dac24"><input type=hidden name=box value="Inbox"><tr><td colspan=2><table width=100%><tr><td class=small valign=bottom>Mailbox: <b>[Inbox]</b> &nbsp;<a href='messages.php?box=Outbox'>[Outbox]</a> &nbsp;<a href='messages.php?box=Saved'>[Saved]</a> &nbsp; &nbsp;</td><td class=small align=right>Show <select onchange='location.href = "messages.php?box=Inbox&begin=1&per_page=" + this.options[this.selectedIndex].value'><option value=1>10</option><option value=2 selected>20</option><option value=5>50</option><option value=10>100</option></select> per page</td></tr></table></td></tr><tr><td align="center" colspan="2" style="font-size: 0.8em; padding-bottom: 0.5em; font-weight: bold;">Note:  Messages in this mailbox will be deleted after two weeks.</td></tr><tr><td align=center valign=bottom><a href="javascript:toggleall();"><b>X</b></a></td><td><table width=100%><tr><td class=small>&nbsp;</td><td align=right class=small>With checked: <a href='javascript:with(document.messageform) { the_action.value="save"; submit(); }'>[save]</a> <a href='javascript:with(document.messageform) { the_action.value="delete"; submit(); }'>[delete]</a></td></tr></table></td></tr><tr><td valign=top><input type=checkbox name="sel143156270"></td><td class=small><span style="color:blue;">New!</span>&nbsp;<b>From</b> <a href="showplayer.php?who=1852283">StuBorn</a> (#1852283)&nbsp;[<a href="sendmessage.php?toid=1852283&replyid=143156270">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1852283&quoteid=143156270&box=Inbox">quoted</a>]<br><b>Date:</b> Thursday, June 03, 2021, 10:29PM</b><!--06/03/21 22:29:35--><br><blockquote>that's the outside note. <br>With a link to <a target=_blank href="https://kol.obeliks.de/buffbot/,"><font color=blue>[link]</font></a> https:// kol.obeliks.de/ buffbot/, which is the *^$%<center><table class="item" style="float: none" rel="id=1167&s=0&q=0&d=0&g=1&t=0&n=1&m=0&p=0&u=."><tr><td><img src="https://s3.amazonaws.com/images.kingdomofloathing.com/itemimages/plainbrown.gif" alt="plain brown wrapper" title="plain brown wrapper" class=hand onClick='descitem(546961999)' ></td><td valign=center class=effect>You acquire an item: <b>plain brown wrapper</b></td></tr></table></center></blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143143752"></td><td class=small><span style="color:blue;">New!</span>&nbsp;<b>From</b> <a href="showplayer.php?who=2320445">Grumpy Old Buffer</a> (#2320445)&nbsp;[<a href="sendmessage.php?toid=2320445&replyid=143143752">reply</a>]&nbsp;[<a href="sendmessage.php?toid=2320445&quoteid=143143752&box=Inbox">quoted</a>]<br><b>Date:</b> Tuesday, June 01, 2021, 11:51PM</b><!--06/01/21 23:51:39--><br><blockquote>Have a look at <a target=_blank href="https://kol.obeliks.de/buffbot,"><font color=blue>[link]</font></a> https:// kol.obeliks.de/ buffbot, my friend</blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143138286"></td><td class=small><b>From</b> <a href="showplayer.php?who=1889009">Buffy</a> (#1889009)&nbsp;[<a href="sendmessage.php?toid=1889009&replyid=143138286">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1889009&quoteid=143138286&box=Inbox">quoted</a>]<br><b>Date:</b> Monday, May 31, 2021, 11:18PM</b><!--05/31/21 23:18:26--><br><blockquote><center><table><tr><td><img src="https://s3.amazonaws.com/images.kingdomofloathing.com/itemimages/meat.gif" height=30 width=30 alt="Meat"></td><td valign=center>You gain 180,000,000 Meat.</td></tr></table></center></blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143101095"></td><td class=small><b>From</b> <a href="showplayer.php?who=1852283">StuBorn</a> (#1852283)&nbsp;[<a href="sendmessage.php?toid=1852283&replyid=143101095">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1852283&quoteid=143101095&box=Inbox">quoted</a>]<br><b>Date:</b> Tuesday, May 25, 2021, 12:43AM</b><!--05/25/21 00:43:51--><br><blockquote>oi2</blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143101089"></td><td class=small><b>From</b> <a href="showplayer.php?who=1852283">StuBorn</a> (#1852283)&nbsp;[<a href="sendmessage.php?toid=1852283&replyid=143101089">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1852283&quoteid=143101089&box=Inbox">quoted</a>]<br><b>Date:</b> Tuesday, May 25, 2021, 12:41AM</b><!--05/25/21 00:41:55--><br><blockquote>oi</blockquote></td></tr><tr><td align=center valign=bottom><a href="javascript:toggleall();"><b>X</b></a></td><td><table width=100%><tr><td class=small>&nbsp;</td><td align=right class=small>With checked: <a href='javascript:with(document.messageform) { the_action.value="save"; submit(); }'>[save]</a> <a href='javascript:with(document.messageform) { the_action.value="delete"; submit(); }'>[delete]</a></td></tr></table></td></tr></form></table></td></tr></table></center></td></tr><tr><td height=4></td></tr></table></center></body></html>`
    //const html = `<html><head><script language=Javascript><!--if (parent.frames.length == 0) location.href="game.php";var actions = {  }var notchat = true;//--></script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/keybinds.min.2.js"></script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/window.20111231.js"></script><script language="javascript">function chatFocus(){if(top.chatpane.document.chatform.graf) top.chatpane.document.chatform.graf.focus();}if (typeof defaultBind != 'undefined') { defaultBind(47, 2, chatFocus); defaultBind(190, 2, chatFocus);defaultBind(191, 2, chatFocus); defaultBind(47, 8, chatFocus);defaultBind(190, 8, chatFocus); defaultBind(191, 8, chatFocus); }</script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/jquery-1.3.1.min.js"></script><script>jQuery(function ($) {$('.grower').each(function () {var t = $(this);var sz = t.attr('data-size');var hgt = t.height();t.css('height', (Math.ceil(hgt / sz) * sz) + 'px');});});</script><script language=Javascript>jQuery(function($) {$('#export').click(function () {$(this).parent().remove();return true;});$('.procbot input').click(function (e) {var pb = $(this).parent();var hid = pb.find('div:hidden');hid.eq(0).show();if (hid.length == 1) $(this).hide();});});<!--function toggleall() {var newval;if (document.messageform[3].checked==true) newval=false; else newval=true;for(var i=0;i<document.messageform.length;i++) {if (document.messageform[i].type=='checkbox') document.messageform[i].checked=newval;}}//--></script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/window.js"></script><script language=Javascript src='https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/rcm.20160406.js'></script>\t<link rel="stylesheet" type="text/css" href="https://s3.amazonaws.com/images.kingdomofloathing.com/styles.20151006.css"><style type='text/css'>.faded {zoom: 1;filter: alpha(opacity=35);opacity: 0.35;-khtml-opacity: 0.35;-moz-opacity: 0.35;}</style></head><body><div id='menu' class=rcm></div><centeR><table  width=95%  cellspacing=0 cellpadding=0><tr><td style="color: white;" align=center bgcolor=blue><b>Messages: Inbox, page 1 (5 messages)</b></td></tr><tr><td style="padding: 5px; border: 1px solid blue;"><center><table><tr><td><center class=small><a href='sendmessage.php'>[write a message]</a><br><a href='makeoffer.php'>[propose or accept a trade]</a>&nbsp;&nbsp;<a href='messages.php?events=1'>[review recent events]</a></center><table width=100%><form name=messageform method=post action=messages.php><input type=hidden name=the_action value=""><input type=hidden name=pwd value="a020091fb5586ba314a7c993fd0dac24"><input type=hidden name=box value="Inbox"><tr><td colspan=2><table width=100%><tr><td class=small valign=bottom>Mailbox: <b>[Inbox]</b> &nbsp;<a href='messages.php?box=Outbox'>[Outbox]</a> &nbsp;<a href='messages.php?box=Saved'>[Saved]</a> &nbsp; &nbsp;</td><td class=small align=right>Show <select onchange='location.href = "messages.php?box=Inbox&begin=1&per_page=" + this.options[this.selectedIndex].value'><option value=1>10</option><option value=2 selected>20</option><option value=5>50</option><option value=10>100</option></select> per page</td></tr></table></td></tr><tr><td align="center" colspan="2" style="font-size: 0.8em; padding-bottom: 0.5em; font-weight: bold;">Note:  Messages in this mailbox will be deleted after two weeks.</td></tr><tr><td align=center valign=bottom><a href="javascript:toggleall();"><b>X</b></a></td><td><table width=100%><tr><td class=small>&nbsp;</td><td align=right class=small>With checked: <a href='javascript:with(document.messageform) { the_action.value="save"; submit(); }'>[save]</a> <a href='javascript:with(document.messageform) { the_action.value="delete"; submit(); }'>[delete]</a></td></tr></table></td></tr><tr><td valign=top><input type=checkbox name="sel143156270"></td><td class=small><b>From</b> <a href="showplayer.php?who=1852283">StuBorn</a> (#1852283)&nbsp;[<a href="sendmessage.php?toid=1852283&replyid=143156270">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1852283&quoteid=143156270&box=Inbox">quoted</a>]<br><b>Date:</b> Thursday, June 03, 2021, 10:29PM</b><!--06/03/21 22:29:35--><br><blockquote>that's the outside note. <br>With a link to <a target=_blank href="https://kol.obeliks.de/buffbot/,"><font color=blue>[link]</font></a> https:// kol.obeliks.de/ buffbot/, which is the *^$%<center><table class="item" style="float: none" rel="id=1167&s=0&q=0&d=0&g=1&t=0&n=1&m=0&p=0&u=."><tr><td><img src="https://s3.amazonaws.com/images.kingdomofloathing.com/itemimages/plainbrown.gif" alt="plain brown wrapper" title="plain brown wrapper" class=hand onClick='descitem(546961999)' ></td><td valign=center class=effect>You acquire an item: <b>plain brown wrapper</b></td></tr></table></center><p>Inside Note:<p>This is the inside note.<br><br>Did you know that <a target=_blank href="https://kol.obeliks.de/buffbot/"><font color=blue>[link]</font></a> https:// kol.obeliks.de/ buffbot/ is the *^$%?<center><table class="item" style="float: none" rel="id=5511&s=0&q=0&d=0&g=0&t=1&n=1&m=0&p=0&u=u"><tr><td><img src="https://s3.amazonaws.com/images.kingdomofloathing.com/itemimages/triviacard.gif" alt="Trivial Avocations Card: What?" title="Trivial Avocations Card: What?" class=hand onClick='descitem(642614129)' ></td><td valign=center class=effect>You acquire an item: <b>Trivial Avocations Card: What?</b></td></tr></table></center></blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143143752"></td><td class=small><b>From</b> <a href="showplayer.php?who=2320445">Grumpy Old Buffer</a> (#2320445)&nbsp;[<a href="sendmessage.php?toid=2320445&replyid=143143752">reply</a>]&nbsp;[<a href="sendmessage.php?toid=2320445&quoteid=143143752&box=Inbox">quoted</a>]<br><b>Date:</b> Tuesday, June 01, 2021, 11:51PM</b><!--06/01/21 23:51:39--><br><blockquote>Have a look at <a target=_blank href="https://kol.obeliks.de/buffbot,"><font color=blue>[link]</font></a> https:// kol.obeliks.de/ buffbot, my friend</blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143138286"></td><td class=small><b>From</b> <a href="showplayer.php?who=1889009">Buffy</a> (#1889009)&nbsp;[<a href="sendmessage.php?toid=1889009&replyid=143138286">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1889009&quoteid=143138286&box=Inbox">quoted</a>]<br><b>Date:</b> Monday, May 31, 2021, 11:18PM</b><!--05/31/21 23:18:26--><br><blockquote><center><table><tr><td><img src="https://s3.amazonaws.com/images.kingdomofloathing.com/itemimages/meat.gif" height=30 width=30 alt="Meat"></td><td valign=center>You gain 180,000,000 Meat.</td></tr></table></center></blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143101095"></td><td class=small><b>From</b> <a href="showplayer.php?who=1852283">StuBorn</a> (#1852283)&nbsp;[<a href="sendmessage.php?toid=1852283&replyid=143101095">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1852283&quoteid=143101095&box=Inbox">quoted</a>]<br><b>Date:</b> Tuesday, May 25, 2021, 12:43AM</b><!--05/25/21 00:43:51--><br><blockquote>oi2</blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143101089"></td><td class=small><b>From</b> <a href="showplayer.php?who=1852283">StuBorn</a> (#1852283)&nbsp;[<a href="sendmessage.php?toid=1852283&replyid=143101089">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1852283&quoteid=143101089&box=Inbox">quoted</a>]<br><b>Date:</b> Tuesday, May 25, 2021, 12:41AM</b><!--05/25/21 00:41:55--><br><blockquote>oi</blockquote></td></tr><tr><td align=center valign=bottom><a href="javascript:toggleall();"><b>X</b></a></td><td><table width=100%><tr><td class=small>&nbsp;</td><td align=right class=small>With checked: <a href='javascript:with(document.messageform) { the_action.value="save"; submit(); }'>[save]</a> <a href='javascript:with(document.messageform) { the_action.value="delete"; submit(); }'>[delete]</a></td></tr></table></td></tr></form></table></td></tr></table></center></td></tr><tr><td height=4></td></tr></table></center></body></html>`
    //const html = `<html><head><script language=Javascript><!--if (parent.frames.length == 0) location.href="game.php";var actions = {  }var notchat = true;//--></script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/keybinds.min.2.js"></script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/window.20111231.js"></script><script language="javascript">function chatFocus(){if(top.chatpane.document.chatform.graf) top.chatpane.document.chatform.graf.focus();}if (typeof defaultBind != 'undefined') { defaultBind(47, 2, chatFocus); defaultBind(190, 2, chatFocus);defaultBind(191, 2, chatFocus); defaultBind(47, 8, chatFocus);defaultBind(190, 8, chatFocus); defaultBind(191, 8, chatFocus); }</script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/jquery-1.3.1.min.js"></script><script>jQuery(function ($) {$('.grower').each(function () {var t = $(this);var sz = t.attr('data-size');var hgt = t.height();t.css('height', (Math.ceil(hgt / sz) * sz) + 'px');});});</script><script language=Javascript>jQuery(function($) {$('#export').click(function () {$(this).parent().remove();return true;});$('.procbot input').click(function (e) {var pb = $(this).parent();var hid = pb.find('div:hidden');hid.eq(0).show();if (hid.length == 1) $(this).hide();});});<!--function toggleall() {var newval;if (document.messageform[3].checked==true) newval=false; else newval=true;for(var i=0;i<document.messageform.length;i++) {if (document.messageform[i].type=='checkbox') document.messageform[i].checked=newval;}}//--></script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/window.js"></script><script language=Javascript src='https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/rcm.20160406.js'></script>\t<link rel="stylesheet" type="text/css" href="https://s3.amazonaws.com/images.kingdomofloathing.com/styles.20151006.css"><style type='text/css'>.faded {zoom: 1;filter: alpha(opacity=35);opacity: 0.35;-khtml-opacity: 0.35;-moz-opacity: 0.35;}</style></head><body><div id='menu' class=rcm></div><centeR><table  width=95%  cellspacing=0 cellpadding=0><tr><td style="color: white;" align=center bgcolor=blue><b>Messages: Inbox, page 1 (7 messages)</b></td></tr><tr><td style="padding: 5px; border: 1px solid blue;"><center><table><tr><td><center class=small><a href='sendmessage.php'>[write a message]</a><br><a href='makeoffer.php'>[propose or accept a trade]</a>&nbsp;&nbsp;<a href='messages.php?events=1'>[review recent events]</a></center><table width=100%><form name=messageform method=post action=messages.php><input type=hidden name=the_action value=""><input type=hidden name=pwd value="85f0acea21c372576ed0d9c26f1367a4"><input type=hidden name=box value="Inbox"><tr><td colspan=2><table width=100%><tr><td class=small valign=bottom>Mailbox: <b>[Inbox]</b> &nbsp;<a href='messages.php?box=Outbox'>[Outbox]</a> &nbsp;<a href='messages.php?box=Saved'>[Saved]</a> &nbsp; &nbsp;</td><td class=small align=right>Show <select onchange='location.href = "messages.php?box=Inbox&begin=1&per_page=" + this.options[this.selectedIndex].value'><option value=1>10</option><option value=2 selected>20</option><option value=5>50</option><option value=10>100</option></select> per page</td></tr></table></td></tr><tr><td align="center" colspan="2" style="font-size: 0.8em; padding-bottom: 0.5em; font-weight: bold;">Note:  Messages in this mailbox will be deleted after two weeks.</td></tr><tr><td align=center valign=bottom><a href="javascript:toggleall();"><b>X</b></a></td><td><table width=100%><tr><td class=small>&nbsp;</td><td align=right class=small>With checked: <a href='javascript:with(document.messageform) { the_action.value="save"; submit(); }'>[save]</a> <a href='javascript:with(document.messageform) { the_action.value="delete"; submit(); }'>[delete]</a></td></tr></table></td></tr><tr><td valign=top><input type=checkbox name="sel143161687"></td><td class=small><b>From</b> <a href="showplayer.php?who=1852283">StuBorn</a> (#1852283)&nbsp;[<a href="sendmessage.php?toid=1852283&replyid=143161687">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1852283&quoteid=143161687&box=Inbox">quoted</a>]<br><b>Date:</b> Friday, June 04, 2021, 09:57PM</b><!--06/04/21 21:57:23--><br><blockquote><center><table><tr><td><img src="https://s3.amazonaws.com/images.kingdomofloathing.com/adventureimages/basicgolem.gif" width=100 height=100></td><td valign=center>I've said it before<br>And I'll say it again:<br>10 PRINT &quot;I Love You&quot;<br>20 GOTO 10</td></tr></table></center><center><table><tr><td><img src="https://s3.amazonaws.com/images.kingdomofloathing.com/itemimages/meat.gif" height=30 width=30 alt="Meat"></td><td valign=center>You gain 42 Meat.</td></tr></table></center></blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143161669"></td><td class=small><b>From</b> <a href="showplayer.php?who=1852283">StuBorn</a> (#1852283)&nbsp;[<a href="sendmessage.php?toid=1852283&replyid=143161669">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1852283&quoteid=143161669&box=Inbox">quoted</a>]<br><b>Date:</b> Friday, June 04, 2021, 09:53PM</b><!--06/04/21 21:53:50--><br><blockquote><center><table><tr><td><img src="https://s3.amazonaws.com/images.kingdomofloathing.com/adventureimages/smiley.gif" width=100 height=100></td><td valign=center>You zerg rush'd my heart<br>Your love gets me high<br>Come give me a kiss<br>You're oh em gee KAWAIIIIIIII!!11!! 11!!!?!!?!</td></tr></table></center>KAWAIIII </blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143156270"></td><td class=small><b>From</b> <a href="showplayer.php?who=1852283">StuBorn</a> (#1852283)&nbsp;[<a href="sendmessage.php?toid=1852283&replyid=143156270">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1852283&quoteid=143156270&box=Inbox">quoted</a>]<br><b>Date:</b> Thursday, June 03, 2021, 10:29PM</b><!--06/03/21 22:29:35--><br><blockquote>that's the outside note. <br>With a link to <a target=_blank href="https://kol.obeliks.de/buffbot/,"><font color=blue>[link]</font></a> https:// kol.obeliks.de/ buffbot/, which is the *^$%<center><table class="item" style="float: none" rel="id=1167&s=0&q=0&d=0&g=1&t=0&n=1&m=0&p=0&u=."><tr><td><img src="https://s3.amazonaws.com/images.kingdomofloathing.com/itemimages/plainbrown.gif" alt="plain brown wrapper" title="plain brown wrapper" class=hand onClick='descitem(546961999)' ></td><td valign=center class=effect>You acquire an item: <b>plain brown wrapper</b></td></tr></table></center><p>Inside Note:<p>This is the inside note.<br><br>Did you know that <a target=_blank href="https://kol.obeliks.de/buffbot/"><font color=blue>[link]</font></a> https:// kol.obeliks.de/ buffbot/ is the *^$%?<center><table class="item" style="float: none" rel="id=5511&s=0&q=0&d=0&g=0&t=1&n=1&m=0&p=0&u=u"><tr><td><img src="https://s3.amazonaws.com/images.kingdomofloathing.com/itemimages/triviacard.gif" alt="Trivial Avocations Card: What?" title="Trivial Avocations Card: What?" class=hand onClick='descitem(642614129)' ></td><td valign=center class=effect>You acquire an item: <b>Trivial Avocations Card: What?</b></td></tr></table></center></blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143143752"></td><td class=small><b>From</b> <a href="showplayer.php?who=2320445">Grumpy Old Buffer</a> (#2320445)&nbsp;[<a href="sendmessage.php?toid=2320445&replyid=143143752">reply</a>]&nbsp;[<a href="sendmessage.php?toid=2320445&quoteid=143143752&box=Inbox">quoted</a>]<br><b>Date:</b> Tuesday, June 01, 2021, 11:51PM</b><!--06/01/21 23:51:39--><br><blockquote>Have a look at <a target=_blank href="https://kol.obeliks.de/buffbot,"><font color=blue>[link]</font></a> https:// kol.obeliks.de/ buffbot, my friend</blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143138286"></td><td class=small><b>From</b> <a href="showplayer.php?who=1889009">Buffy</a> (#1889009)&nbsp;[<a href="sendmessage.php?toid=1889009&replyid=143138286">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1889009&quoteid=143138286&box=Inbox">quoted</a>]<br><b>Date:</b> Monday, May 31, 2021, 11:18PM</b><!--05/31/21 23:18:26--><br><blockquote><center><table><tr><td><img src="https://s3.amazonaws.com/images.kingdomofloathing.com/itemimages/meat.gif" height=30 width=30 alt="Meat"></td><td valign=center>You gain 180,000,000 Meat.</td></tr></table></center></blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143101095"></td><td class=small><b>From</b> <a href="showplayer.php?who=1852283">StuBorn</a> (#1852283)&nbsp;[<a href="sendmessage.php?toid=1852283&replyid=143101095">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1852283&quoteid=143101095&box=Inbox">quoted</a>]<br><b>Date:</b> Tuesday, May 25, 2021, 12:43AM</b><!--05/25/21 00:43:51--><br><blockquote>oi2</blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143101089"></td><td class=small><b>From</b> <a href="showplayer.php?who=1852283">StuBorn</a> (#1852283)&nbsp;[<a href="sendmessage.php?toid=1852283&replyid=143101089">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1852283&quoteid=143101089&box=Inbox">quoted</a>]<br><b>Date:</b> Tuesday, May 25, 2021, 12:41AM</b><!--05/25/21 00:41:55--><br><blockquote>oi</blockquote></td></tr><tr><td align=center valign=bottom><a href="javascript:toggleall();"><b>X</b></a></td><td><table width=100%><tr><td class=small>&nbsp;</td><td align=right class=small>With checked: <a href='javascript:with(document.messageform) { the_action.value="save"; submit(); }'>[save]</a> <a href='javascript:with(document.messageform) { the_action.value="delete"; submit(); }'>[delete]</a></td></tr></table></td></tr></form></table></td></tr></table></center></td></tr><tr><td height=4></td></tr></table></center></body></html>`;
    const html = `<html><head><script language=Javascript><!--if (parent.frames.length == 0) location.href="game.php";var actions = {  }var notchat = true;//--></script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/keybinds.min.2.js"></script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/window.20111231.js"></script><script language="javascript">function chatFocus(){if(top.chatpane.document.chatform.graf) top.chatpane.document.chatform.graf.focus();}if (typeof defaultBind != 'undefined') { defaultBind(47, 2, chatFocus); defaultBind(190, 2, chatFocus);defaultBind(191, 2, chatFocus); defaultBind(47, 8, chatFocus);defaultBind(190, 8, chatFocus); defaultBind(191, 8, chatFocus); }</script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/jquery-1.3.1.min.js"></script><script>jQuery(function ($) {$('.grower').each(function () {var t = $(this);var sz = t.attr('data-size');var hgt = t.height();t.css('height', (Math.ceil(hgt / sz) * sz) + 'px');});});</script><script language=Javascript>jQuery(function($) {$('#export').click(function () {$(this).parent().remove();return true;});$('.procbot input').click(function (e) {var pb = $(this).parent();var hid = pb.find('div:hidden');hid.eq(0).show();if (hid.length == 1) $(this).hide();});});<!--function toggleall() {var newval;if (document.messageform[3].checked==true) newval=false; else newval=true;for(var i=0;i<document.messageform.length;i++) {if (document.messageform[i].type=='checkbox') document.messageform[i].checked=newval;}}//--></script><script language=Javascript src="https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/window.js"></script><script language=Javascript src='https://s3.amazonaws.com/images.kingdomofloathing.com/scripts/rcm.20160406.js'></script>\t<link rel="stylesheet" type="text/css" href="https://s3.amazonaws.com/images.kingdomofloathing.com/styles.20151006.css"><style type='text/css'>.faded {zoom: 1;filter: alpha(opacity=35);opacity: 0.35;-khtml-opacity: 0.35;-moz-opacity: 0.35;}</style></head><body><div id='menu' class=rcm></div><centeR><table  width=95%  cellspacing=0 cellpadding=0><tr><td style="color: white;" align=center bgcolor=blue><b>Messages: Inbox, page 2 (11 - 16 of 16)</b></td></tr><tr><td style="padding: 5px; border: 1px solid blue;"><center><table><tr><td><center class=small><a href='sendmessage.php'>[write a message]</a><br><a href='makeoffer.php'>[propose or accept a trade]</a>&nbsp;&nbsp;<a href='messages.php?events=1'>[review recent events]</a></center><table width=100%><form name=messageform method=post action=messages.php><input type=hidden name=the_action value=""><input type=hidden name=pwd value="ca6cf98a76a5105d4f8d120a6566001f"><input type=hidden name=box value="Inbox"><tr><td colspan=2><table width=100%><tr><td class=small>Jump to page: <a href='messages.php?box=Inbox&begin=1'>[1]</a>  <b>[2]</b> </td><td align=right class=small>Order: <select onchange='location.href = "messages.php?box=Inbox&begin=1&order=" + this.options[this.selectedIndex].value;'><option value=0 selected>Newest Date First</option><option value=1>Oldest Date First</select></td></tr><tr><td class=small valign=bottom>Mailbox: <b>[Inbox]</b> &nbsp;<a href='messages.php?box=Outbox'>[Outbox]</a> &nbsp;<a href='messages.php?box=Saved'>[Saved]</a> &nbsp; &nbsp;</td><td class=small align=right>Show <select onchange='location.href = "messages.php?box=Inbox&begin=1&per_page=" + this.options[this.selectedIndex].value'><option value=1 selected>10</option><option value=2>20</option><option value=5>50</option><option value=10>100</option></select> per page</td></tr></table></td></tr><tr><td align="center" colspan="2" style="font-size: 0.8em; padding-bottom: 0.5em; font-weight: bold;">Note:  Messages in this mailbox will be deleted after two weeks.</td></tr><tr><td align=center valign=bottom><a href="javascript:toggleall();"><b>X</b></a></td><td><table width=100%><tr><td class=small>&nbsp;</td><td align=right class=small>With checked: <a href='javascript:with(document.messageform) { the_action.value="save"; submit(); }'>[save]</a> <a href='javascript:with(document.messageform) { the_action.value="delete"; submit(); }'>[delete]</a></td></tr></table></td></tr><tr><td valign=top><input type=checkbox name="sel143172712"></td><td class=small><b>From</b> <a href="showplayer.php?who=1852283">StuBorn</a> (#1852283)&nbsp;[<a href="sendmessage.php?toid=1852283&replyid=143172712">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1852283&quoteid=143172712&box=Inbox">quoted</a>]<br><b>Date:</b> Monday, June 07, 2021, 12:15AM</b><!--06/07/21 00:15:48--><br><blockquote><center><table class="item" style="float: none" rel="id=7037&s=0&q=0&d=0&g=0&t=1&n=1&m=0&p=0&u=u"><tr><td><img src="https://s3.amazonaws.com/images.kingdomofloathing.com/itemimages/wblprom.gif" alt="warbear LP-ROM burner" title="warbear LP-ROM burner" class=hand onClick='descitem(448554185)' ></td><td valign=center class=effect>You acquire an item: <b>warbear LP-ROM burner</b></td></tr></table></center></blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143161687"></td><td class=small><b>From</b> <a href="showplayer.php?who=1852283">StuBorn</a> (#1852283)&nbsp;[<a href="sendmessage.php?toid=1852283&replyid=143161687">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1852283&quoteid=143161687&box=Inbox">quoted</a>]<br><b>Date:</b> Friday, June 04, 2021, 09:57PM</b><!--06/04/21 21:57:23--><br><blockquote><center><table><tr><td><img src="https://s3.amazonaws.com/images.kingdomofloathing.com/adventureimages/basicgolem.gif" width=100 height=100></td><td valign=center>I've said it before<br>And I'll say it again:<br>10 PRINT &quot;I Love You&quot;<br>20 GOTO 10</td></tr></table></center><center><table><tr><td><img src="https://s3.amazonaws.com/images.kingdomofloathing.com/itemimages/meat.gif" height=30 width=30 alt="Meat"></td><td valign=center>You gain 42 Meat.</td></tr></table></center></blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143161669"></td><td class=small><b>From</b> <a href="showplayer.php?who=1852283">StuBorn</a> (#1852283)&nbsp;[<a href="sendmessage.php?toid=1852283&replyid=143161669">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1852283&quoteid=143161669&box=Inbox">quoted</a>]<br><b>Date:</b> Friday, June 04, 2021, 09:53PM</b><!--06/04/21 21:53:50--><br><blockquote><center><table><tr><td><img src="https://s3.amazonaws.com/images.kingdomofloathing.com/adventureimages/smiley.gif" width=100 height=100></td><td valign=center>You zerg rush'd my heart<br>Your love gets me high<br>Come give me a kiss<br>You're oh em gee KAWAIIIIIIII!!11!! 11!!!?!!?!</td></tr></table></center>KAWAIIII </blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143156270"></td><td class=small><b>From</b> <a href="showplayer.php?who=1852283">StuBorn</a> (#1852283)&nbsp;[<a href="sendmessage.php?toid=1852283&replyid=143156270">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1852283&quoteid=143156270&box=Inbox">quoted</a>]<br><b>Date:</b> Thursday, June 03, 2021, 10:29PM</b><!--06/03/21 22:29:35--><br><blockquote>that's the outside note. <br>With a link to <a target=_blank href="https://kol.obeliks.de/buffbot/,"><font color=blue>[link]</font></a> https:// kol.obeliks.de/ buffbot/, which is the *^$%<center><table class="item" style="float: none" rel="id=1167&s=0&q=0&d=0&g=1&t=0&n=1&m=0&p=0&u=."><tr><td><img src="https://s3.amazonaws.com/images.kingdomofloathing.com/itemimages/plainbrown.gif" alt="plain brown wrapper" title="plain brown wrapper" class=hand onClick='descitem(546961999)' ></td><td valign=center class=effect>You acquire an item: <b>plain brown wrapper</b></td></tr></table></center><p>Inside Note:<p>This is the inside note.<br><br>Did you know that <a target=_blank href="https://kol.obeliks.de/buffbot/"><font color=blue>[link]</font></a> https:// kol.obeliks.de/ buffbot/ is the *^$%?<center><table class="item" style="float: none" rel="id=5511&s=0&q=0&d=0&g=0&t=1&n=1&m=0&p=0&u=u"><tr><td><img src="https://s3.amazonaws.com/images.kingdomofloathing.com/itemimages/triviacard.gif" alt="Trivial Avocations Card: What?" title="Trivial Avocations Card: What?" class=hand onClick='descitem(642614129)' ></td><td valign=center class=effect>You acquire an item: <b>Trivial Avocations Card: What?</b></td></tr></table></center></blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143143752"></td><td class=small><b>From</b> <a href="showplayer.php?who=2320445">Grumpy Old Buffer</a> (#2320445)&nbsp;[<a href="sendmessage.php?toid=2320445&replyid=143143752">reply</a>]&nbsp;[<a href="sendmessage.php?toid=2320445&quoteid=143143752&box=Inbox">quoted</a>]<br><b>Date:</b> Tuesday, June 01, 2021, 11:51PM</b><!--06/01/21 23:51:39--><br><blockquote>Have a look at <a target=_blank href="https://kol.obeliks.de/buffbot,"><font color=blue>[link]</font></a> https:// kol.obeliks.de/ buffbot, my friend</blockquote></td></tr><tr><td valign=top><input type=checkbox name="sel143138286"></td><td class=small><b>From</b> <a href="showplayer.php?who=1889009">Buffy</a> (#1889009)&nbsp;[<a href="sendmessage.php?toid=1889009&replyid=143138286">reply</a>]&nbsp;[<a href="sendmessage.php?toid=1889009&quoteid=143138286&box=Inbox">quoted</a>]<br><b>Date:</b> Monday, May 31, 2021, 11:18PM</b><!--05/31/21 23:18:26--><br><blockquote><center><table><tr><td><img src="https://s3.amazonaws.com/images.kingdomofloathing.com/itemimages/meat.gif" height=30 width=30 alt="Meat"></td><td valign=center>You gain 180,000,000 Meat.</td></tr></table></center></blockquote></td></tr><tr><td align=center valign=bottom><a href="javascript:toggleall();"><b>X</b></a></td><td><table width=100%><tr><td class=small>&nbsp;</td><td align=right class=small>With checked: <a href='javascript:with(document.messageform) { the_action.value="save"; submit(); }'>[save]</a> <a href='javascript:with(document.messageform) { the_action.value="delete"; submit(); }'>[delete]</a></td></tr></table></td></tr><tr><td></td><td class=small>Jump to page: <a href='messages.php?box=Inbox&begin=1'>[1]</a>  <b>[2]</b> </td></tr></form></table></td></tr></table></center></td></tr><tr><td height=4></td></tr></table></center></body></html>`
    const result = parseFolder(html);

    expect(result).toEqual([]);
  });
})


describe('unchunkLink', () => {
  it('should unchunk links without trailing text', () => {
    expect(
      unchunkLink('https://kol.obeliks.de/buffbot/', 'https://kol. obeliks.de /buf fbot/')
    ).toEqual('https://kol.obeliks.de/buffbot/')
  })
  it('should unchunk links with trailing text with space', () => {
    expect(
      unchunkLink('https://kol.obeliks.de/buffbot/', 'https://kol. obeliks.de /buf fbot/ is the shit')
    ).toEqual('https://kol.obeliks.de/buffbot/ is the shit')
  })
  it('should unchunk links with trailing text without space', () => {
    expect(
      unchunkLink('https://kol.obeliks.de/buffbot/', 'https://kol. obeliks.de /buf fbot/, the best buffbot')
    ).toEqual('https://kol.obeliks.de/buffbot/, the best buffbot')
  })
  it('should pass through unchunked links', () => {
    expect(
      unchunkLink('https://kol.obeliks.de/buffbot/', 'https://kol.obeliks.de/buffbot/')
    ).toEqual('https://kol.obeliks.de/buffbot/')
  })
  it('should pass through unchunked links with trailing text', () => {
    expect(
      unchunkLink('https://kol.obeliks.de/buffbot/', 'https://kol.obeliks.de/buffbot/ is the shit')
    ).toEqual('https://kol.obeliks.de/buffbot/ is the shit')
  })
  it('should pass through unchunked links with trailing text without space', () => {
    expect(
      unchunkLink('https://kol.obeliks.de/buffbot/', 'https://kol.obeliks.de/buffbot/, the best buffbot')
    ).toEqual('https://kol.obeliks.de/buffbot/, the best buffbot')
  })
})